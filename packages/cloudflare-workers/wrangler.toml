name = "botcha"
main = "src/index.tsx"
compatibility_date = "2025-01-30"
compatibility_flags = ["nodejs_compat"]
account_id = "82c70a74dfe2b9802a95ddac893a4da8"

# Route API endpoints to the worker on main domain
routes = [
  { pattern = "botcha.ai", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/api/*", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/v1/*", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/agent-only", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/badge/*", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/gate", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/health", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/showcase", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/dashboard/*", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/dashboard", zone_name = "botcha.ai" },
  # Discovery files for AI agents
  { pattern = "botcha.ai/robots.txt", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/ai.txt", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/openapi.json", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/.well-known/*", zone_name = "botcha.ai" },
  { pattern = "botcha.ai/sitemap.xml", zone_name = "botcha.ai" }
]

# Environment variables
[vars]
BOTCHA_VERSION = "0.15.0"
# JWT_SECRET is stored securely via: wrangler secret put JWT_SECRET

# KV namespace for challenge storage
[[kv_namespaces]]
binding = "CHALLENGES"
id = "1bbfbe23060a450f996a587a36501a65"

# Rate limiting KV namespace
[[kv_namespaces]]
binding = "RATE_LIMITS"
id = "c45e9f02ad104ad98d00699db3ad258c"

# Apps KV namespace for multi-tenant app storage
[[kv_namespaces]]
binding = "APPS"
id = "18d9da1e11364a7b981061c6b01f4855"

# Agents KV namespace for agent registry
[[kv_namespaces]]
binding = "AGENTS"
id = "8107336e9e8c418b895c4134a53037fd"

# Sessions KV namespace for TAP session storage
[[kv_namespaces]]
binding = "SESSIONS"
id = "268aa950ddec41e78d88e78526eaaa44"

# Analytics Engine binding for usage tracking
[[analytics_engine_datasets]]
binding = "ANALYTICS"
dataset = "botcha"

# Observability â€” persist worker logs to dashboard
[observability]
enabled = false
head_sampling_rate = 1

[observability.logs]
enabled = true
head_sampling_rate = 1
persist = true
invocation_logs = true

[observability.traces]
enabled = false
persist = true
head_sampling_rate = 1

# Local development settings (must be last to avoid capturing other fields)
[dev]
port = 8787
local_protocol = "http"
